const gps=new GPS;const rawLines=[];const MAX_LINES=200;gps.on("data",function(t){if(t.type==="GGA"){document.getElementById("lat").textContent=t.lat!==null?t.lat.toFixed(6):"–";document.getElementById("lon").textContent=t.lon!==null?t.lon.toFixed(6):"–";document.getElementById("fix").textContent=t.fix!==null?t.fix:"–";document.getElementById("sats").textContent=t.satellites!==null?t.satellites:"–"}});async function pollNMEA(){try{const t=await fetch("/nmea",{cache:"no-store"});if(!t.ok)return;const e=await t.text();const n=e.trim().split("\n");for(const l of n){if(!l.startsWith("$"))continue;rawLines.push(l);gps.update(l);if(rawLines.length>MAX_LINES){rawLines.shift()}}const o=document.getElementById("raw");o.textContent=rawLines.join("\n");o.scrollTop=o.scrollHeight}catch(t){console.log("NMEA fetch failed")}}setInterval(pollNMEA,1e3);